# 06. UI/UX - 画面仕様とインタラクション

## 📋 概要

`02_requirements.md` と `05_api_design.md` を踏まえたUI/UX方針を示します。  
小規模利用（数人）を想定し、シンプルかつツリー操作に特化した体験を優先します。

---

## 🎨 デザイン原則
- **文脈の見通し**: ツリー構造を視覚的に把握しやすくする
- **分岐のしやすさ**: 任意メッセージからの「続ける」をワンクリックで
- **状態の即時性**: 送信/ストリーミング中のフィードバックを明確に
- **安全な操作**: 認証済みのみが閲覧・投稿できることをUIでも示す
- **レスポンシブ**: デスクトップ最優先、タブレット対応、モバイルは最低限の閲覧/送信

---

## 🗂 主要画面

### 1. 認証フロー
- **ログイン**: **GitHubでログイン**（Supabase Auth / GitHub OAuth）
- フィードバック: OAuth開始/完了/失敗が分かる表示（エラーバナー、リトライ導線）
- セッション失効時: トースト + ログイン画面へ誘導

### 2. セッション一覧
- 一覧カード: タイトル、作成日、最終更新日
- 新規作成ボタン: モーダルまたは右上CTA
- アクセス制御: 認証なしでは一覧を表示しない（ログイン導線）

### 3. 会話ビュー（ツリー + メッセージ）
- レイアウト:
  - 左: セッション一覧（折りたたみ可）
  - 中央: メッセージツリー（縦スクロール、ツリー表示）
  - 右: 選択スレッドのメッセージタイムライン（ストリーミング対応）
- ツリー表示:
  - 0階層目（最上段）を横または縦リストで表示し、選択で枝を展開
  - 子ノードはインデントまたはコネクタラインで表現
  - 選択中ノードをハイライト
- メッセージタイムライン:
  - 選択スレッドの先祖チェーン + 現在のスレッドを時系列で表示
  - 送信中/ストリーミング中はプレースホルダー気泡を表示
- コンテキスト表示:
  - 「このスレッドのコンテキスト」をサマリ表示（R1..Rk + 祖先チェーン）
  - 必要に応じて折りたたみ

### 4. 入力エリア
- 親メッセージが明示されるラベル（「このメッセージから続ける: <抜粋>」）
- 送信ボタン + Shift+Enterで改行
- ストリーミング開始時に送信ボタンを一時無効化、停止ボタンを表示（任意）

### 5. エンプティ/エラー/ローディング
- エンプティ: 「最初のメッセージを追加」CTA
- ローディング: Skeleton
- エラー: バナー + 再試行ボタン（ツリー取得失敗、LLM呼び出し失敗など）

---

## 🔄 主要ユーザーフロー

1) **ログイン → セッション選択/作成 → 0階層目メッセージ投稿 → 任意メッセージから分岐 → LLM返信取得（ストリーミング表示）**
2) **過去のスレッドに戻り、任意メッセージを選択して再開**（祖先チェーンを表示し、そこから続けて投稿）
3) **セッション一覧でフィルタ/検索**（小規模想定なので簡易テキスト検索で十分）

---

## 🧭 ナビゲーションと操作

- **メッセージ選択**: クリックで選択し、右ペインにタイムラインを表示
- **分岐操作**: メッセージに「続ける」ボタン（ホバー/コンテキストメニュー）。押下で入力欄に親IDをセット
- **ツリー折りたたみ**: 子ノードの折りたたみ/展開（大きなツリーへの備え）
- **スクロール同期**: ツリー側とタイムライン側を連動ハイライト（任意）

---

## 📏 レイアウトとレスポンシブ

- ブレークポイント目安:
  - Desktop ≥ 1280px: 3カラム（左ナビ / ツリー / タイムライン）
  - Tablet 768–1279px: 2カラム（ツリーとタイムラインをタブ切り替え）
  - Mobile < 768px: 1カラム（一覧 → 詳細の遷移型、分岐操作はロングプレス/メニュー）

---

## ♿ アクセシビリティ
- キーボード操作: フォーカスリング、Enter/Spaceでノード選択、Escでモーダル閉
- スクリーンリーダー: ツリーを`role="tree"`/`role="treeitem"`で表現、現在選択をaria-liveで通知
- コントラスト: WCAG AAを満たす配色

---

## 🔐 認証・アクセス制御のUI
- 未ログイン時: 一覧・会話ビューは非表示。ログイン画面へ誘導
- 所有者チェックで403の場合: 権限エラーバナーと一覧への戻り導線

---

## 📡 LLMストリーミング表示
- タイピングインジケーター（3ドットアニメ）を表示
- 部分的に到着したテキストを逐次レンダリング
- 中断ボタン（任意）。中断時は「途中で停止しました」と注記

---

## 🧪 テスト観点（UI/UX）
- ツリー表示/選択/分岐が正しく動くこと
- 認証なしで保護リソースにアクセスできないこと
- ストリーミング中の表示と中断動作
- エンプティ/エラー/ローディング状態の表示
- モバイル幅での主要フロー（閲覧・投稿・分岐）が成立すること


