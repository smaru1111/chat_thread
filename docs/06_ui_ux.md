# 06. UI/UX - 画面仕様とインタラクション

## 📋 概要

`02_requirements.md` と `05_api_design.md` を踏まえたUI/UX方針を示します。  
小規模利用（数人）を想定し、シンプルかつツリー操作に特化した体験を優先します。

---

## 🎨 デザイン原則
- **文脈の見通し**: ツリー構造を視覚的に把握しやすくする
- **分岐のしやすさ**: 任意メッセージからの「続ける」をワンクリックで
- **状態の即時性**: 送信/ストリーミング中のフィードバックを明確に
- **安全な操作**: 認証済みのみが閲覧・投稿できることをUIでも示す
- **レスポンシブ**: デスクトップ最優先、タブレット対応、モバイルは最低限の閲覧/送信

---

## 🗂 主要画面

### 1. 認証フロー
- **ログイン**: **GitHubでログイン**（Supabase Auth / GitHub OAuth）
- フィードバック: OAuth開始/完了/失敗が分かる表示（エラーバナー、リトライ導線）
- セッション失効時: トースト + ログイン画面へ誘導

### 2. セッション一覧
- 一覧カード: タイトル、作成日、最終更新日
- 新規作成ボタン: モーダルまたは右上CTA
- アクセス制御: 認証なしでは一覧を表示しない（ログイン導線）

### 3. 会話ビュー（Slack参考：配置はメイン + スレッド）
このアプリのUIは「会話＝タイムライン」「分岐＝スレッド」として扱います。  
**SlackのUIは“見た目”ではなく“配置（中央＝メイン、右＝スレッド）”のみ参考**にします。スタイルは `shadcn/ui` のデフォルトを基本とします。

#### 用語（UI上の見え方）
- **0階層目（メインの会話）**: 会話の“表”に並ぶメッセージ列。基本は「ユーザー→AI」の**1ターンがセット**で縦に積み上がる
- **スレッド**: メインにある **AIの返信** を起点にした“裏の会話”。Slackのスレッド返信のように右ペインで表示する

#### レイアウト（Desktop）
- 左: セッション一覧（折りたたみ可）
- 中央: **メインの会話タイムライン**（0階層目を縦に表示。Slackのチャンネル相当）
- 右: **スレッドペイン**（選択中のAIメッセージに紐づくスレッドを表示。未選択時は空状態）

#### メイン（中央）の表示ルール
- 0階層目は「ユーザーの質問」と「AIの回答」を連続した2つの吹き出しとして表示する
- AIメッセージには、右上などに**スレッド件数**（例: `3 replies` 相当）を表示できる（任意/後追い）
- AIメッセージをホバーすると、アクションとして **「スレッドで質問」** ボタンを表示する
  - クリックすると右ペインが開き、そのAIメッセージを起点にスレッド入力ができる

#### スレッド（右）の表示ルール
- 先頭に「起点のAIメッセージ」を固定表示（引用/プレビュー）
- その下に、スレッド内のメッセージ（ユーザー/AI）を時系列に表示する
- スレッド入力欄のラベルは「この回答にスレッドで質問」など、親が分かる文言にする
- ストリーミング中はメイン同様、プレースホルダー気泡 + 逐次レンダリングを行う

#### コンテキストの扱い（UI観点）
- ユーザーは「ツリー構造」を意識しなくて良い
- スレッドで送信した際に、LLMへ渡す文脈は **自動で抽出**される（`02_requirements.md` のFR-3.1に従う）

### 4. 入力エリア
入力欄は「メイン用」と「スレッド用」で役割が明確に分かれます。

#### メイン入力（中央下）
- 新しい0階層目（メインの会話）として送信する
- 送信ボタン + Shift+Enterで改行
- ストリーミング開始時に送信ボタンを一時無効化、停止ボタンを表示（任意）

#### スレッド入力（右下）
- 「スレッドで質問」ボタンで選択した **AIメッセージ** を親として送信する
- 親が変わったら入力欄のラベルも更新（例: 「この回答にスレッドで質問」）

### 5. エンプティ/エラー/ローディング
- エンプティ: 「最初のメッセージを追加」CTA
- ローディング: Skeleton
- エラー: バナー + 再試行ボタン（ツリー取得失敗、LLM呼び出し失敗など）

---

## 🔄 主要ユーザーフロー

1) **ログイン → セッション選択/作成 → メインで質問 → AI回答（ストリーミング表示）**
2) **AI回答をホバー →「スレッドで質問」→ 右ペインで深掘り → AI回答（ストリーミング）**
3) **別のAI回答に対しても同様にスレッドを作り、並列に深掘りする**
4) **セッション一覧でフィルタ/検索**（小規模想定なので簡易テキスト検索で十分）

---

## 🧭 ナビゲーションと操作

- **スレッドを開く**: AIメッセージのホバーで「スレッドで質問」→ 右ペインにスレッド表示
- **スレッド切替**: 別のAIメッセージで「スレッドで質問」すると右ペインの内容が切り替わる
- **戻る**: 右ペインに閉じるボタン（またはEsc）でスレッドを閉じ、メインに集中できる
- **スレッドの存在を示す**: AIメッセージに返信件数/最終更新を表示（任意）

---

## 📏 レイアウトとレスポンシブ

- ブレークポイント目安:
  - Desktop ≥ 1280px: 3カラム（左ナビ / メイン / スレッド）
  - Tablet 768–1279px: 2カラム（左ナビ / メイン、スレッドはドロワー or 画面遷移）
  - Mobile < 768px: 1カラム（一覧 → メイン → スレッドの画面遷移型）

---

## ♿ アクセシビリティ
- キーボード操作: フォーカスリング、Enter/Spaceでノード選択、Escでモーダル閉
- スクリーンリーダー: ツリーを`role="tree"`/`role="treeitem"`で表現、現在選択をaria-liveで通知
- コントラスト: WCAG AAを満たす配色

---

## 🔐 認証・アクセス制御のUI
- 未ログイン時: 一覧・会話ビューは非表示。ログイン画面へ誘導
- 所有者チェックで403の場合: 権限エラーバナーと一覧への戻り導線

---

## 📡 LLMストリーミング表示
- タイピングインジケーター（3ドットアニメ）を表示
- 部分的に到着したテキストを逐次レンダリング
- 中断ボタン（任意）。中断時は「途中で停止しました」と注記

---

## 🧪 テスト観点（UI/UX）
- ツリー表示/選択/分岐が正しく動くこと
- 認証なしで保護リソースにアクセスできないこと
- ストリーミング中の表示と中断動作
- エンプティ/エラー/ローディング状態の表示
- モバイル幅での主要フロー（閲覧・投稿・分岐）が成立すること


